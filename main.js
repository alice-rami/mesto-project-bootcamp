(()=>{"use strict";var e,t={formSelector:".form",inputSelector:".form__input",inputInvalidSelector:".form__input_invalid",submitButtonSelector:".form__submit-button"},n=document.querySelector(".cards__list"),r=document.querySelector(".profile__add-button"),o=document.querySelector(".popup_type_add-card"),c=document.forms["place-form"],i=c.elements["place-title"],a=c.elements["place-link"],u=document.querySelector(".popup_type_confirm-deletion"),l=document.forms["confirm-deletion-form"],d=document.querySelector(".profile"),s=d.querySelector(".profile__name"),f=d.querySelector(".profile__about"),m=d.querySelector(".profile__avatar"),p=d.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_profile"),_=document.forms["profile-form"],y=_.elements["profile-name"],h=_.elements["profile-about"],S=d.querySelector(".profile__avatar-edit-button"),b=document.querySelector(".popup_type_edit-avatar"),E=document.forms["avatar-form"],k=E.elements["avatar-link"],g=document.querySelectorAll(".popup"),q=Array.from(document.querySelectorAll(".popup__close-icon")),L=function(e){document.querySelector("#error-".concat(e.id)).textContent="",e.classList.remove(t.inputInvalidSelector)},C=function(e){e.disabled=!0},w=function(e){e.validity.valid?L(e):function(e,n){document.querySelector("#error-".concat(e.id)).textContent=n,e.classList.add(t.inputInvalidSelector)}(e,e.validationMessage)},x=function(e,t){e.checkValidity()?function(e){e.disabled=!1}(t):C(t)},A={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-9",headers:{authorization:"c1d6c920-f67e-42f9-9dd3-963993549d9b","Content-Type":"application/json"}},O=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},j=function(e,t){return fetch("".concat(A.baseUrl,"/").concat(e),t).then(O)},T=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",I)},I=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");T(t)}},N=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",I)},P=function(e){e.target.classList.contains("popup")&&T(e.target)},J=document.getElementById("card__template").content.querySelector(".card"),D=document.querySelector(".popup_type_view-image"),U=D.querySelector(".view-template__image"),B=D.querySelector(".view-template__title"),H=function(e,t){t.textContent=e},M=function(e,t,n){var r=J.cloneNode(!0),o=r.querySelector(".card__image"),c=r.querySelector(".card__title"),i=r.querySelector(".card__like-button"),a=r.querySelector(".card__remove-button"),u=r.querySelector(".card__likes-count");return o.src=e.link,o.alt=e.name,c.textContent=e.name,u.textContent=e.likes.length,o.addEventListener("click",(function(){return function(e){U.src=e.link,U.alt=e.name,B.textContent=e.name,N(D)}(e)})),i.addEventListener("click",(function(){!function(e,t,n){e.classList.contains("card__like-button_active")?function(e){return j("cards/likes/".concat(e),{headers:A.headers,method:"DELETE",body:JSON.stringify({_id:e})})}(t).then((function(t){H(t.likes.length,n),e.classList.remove("card__like-button_active")})).catch((function(e){console.log(e)})):function(e){return j("cards/likes/".concat(e),{headers:A.headers,method:"PUT",body:JSON.stringify({_id:e})})}(t).then((function(t){H(t.likes.length,n),e.classList.add("card__like-button_active")})).catch((function(e){console.log(e)}))}(i,e._id,u)})),e.likes.forEach((function(e){e._id!==t||i.classList.add("card__like-button_active")})),e.owner._id===t&&(a.classList.add("card__remove-button_active"),a.addEventListener("click",(function(){n(e._id,r)}))),r},z=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?r:n};function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $={},F=function(t){s.textContent=t.name,f.textContent=t.about,m.src=t.avatar,e=t._id},G=function(e){var t=R(e);n.prepend(t)};Promise.all([j("users/me",{headers:A.headers}),j("cards",{headers:A.headers})]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,i,a=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];F(o),c.forEach(G)})).catch(console.error);var K=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.preventDefault();var r=t.submitter,o=r.textContent;z(!0,r,o,n),e().then((function(){t.target.reset(),T(t.target.closest(".popup"))})).catch(console.error).finally((function(){z(!1,r,o)}))};p.addEventListener("click",(function(){y.value=s.textContent,h.value=f.textContent,N(v)})),_.addEventListener("submit",(function(e){K((function(){return(e={name:y.value,about:h.value},j("users/me",{headers:A.headers,method:"PATCH",body:JSON.stringify({name:e.name,about:e.about})})).then(F);var e}),e)})),E.addEventListener("submit",(function(e){K((function(){return(e=k.value,j("users/me/avatar",{headers:A.headers,method:"PATCH",body:JSON.stringify({avatar:e})})).then(F);var e}),e)})),S.addEventListener("click",(function(){E.reset(),N(b)}));var Q=function(e,t){N(u),$.id=e,$.element=t};l.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=!0,new Promise((function(e,n){var r;t?e((r=$.id,j("cards/".concat(r),{headers:A.headers,method:"DELETE",body:JSON.stringify({_id:r})}))):n("Удаление отменено")}))).then((function(){$.element.remove(),T(u)})).catch(console.error)}));var R=function(t){return M(t,e,Q)};r.addEventListener("click",(function(){c.reset(),N(o)})),c.addEventListener("submit",(function(e){K((function(){return(e={name:i.value,link:a.value},j("cards",{headers:A.headers,method:"POST",body:JSON.stringify({name:e.name,link:e.link})})).then(G);var e}),e)})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){!function(e,t){var n=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);x(e,r),e.addEventListener("reset",(function(){C(r),n.forEach(L)})),n.forEach((function(t){t.addEventListener("input",(function(){w(t),x(e,r)}))}))}(t,e)}))}(t),q.forEach((function(e){e.addEventListener("click",(function(){return T(e.closest(".popup"))}))})),g.forEach((function(e){e.addEventListener("mousedown",P)}))})();