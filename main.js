(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{X:()=>S});var t=function(e){document.querySelector("#error-".concat(e.id)).textContent="",e.classList.remove(S.inputInvalidSelector)},n=function(e){e.disabled=!0},o=function(e){e.validity.valid?t(e):function(e,t){document.querySelector("#error-".concat(e.id)).textContent=t,e.classList.add(S.inputInvalidSelector)}(e,e.validationMessage)},c=function(e,t){e.checkValidity()?function(e){e.disabled=!1}(t):n(t)},r={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-9",headers:{authorization:"c1d6c920-f67e-42f9-9dd3-963993549d9b","Content-Type":"application/json"}},i=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},a=document.querySelectorAll(".popup"),u=Array.from(document.querySelectorAll(".popup__close-icon")),l=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",s)};u.forEach((function(e){e.addEventListener("click",(function(){return l(e.closest(".popup"))}))}));var s=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");l(t)}},d=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",s)},f=function(e){e.target.classList.contains("popup")&&l(e.target)};a.forEach((function(e){e.addEventListener("mousedown",f)}));var m,p=document.getElementById("card__template").content.querySelector(".card"),v=document.querySelector(".popup_type_view-image"),_=v.querySelector(".view-template__image"),h=v.querySelector(".view-template__title"),y=function(e,t){t.textContent=e},b=function(e,t,n){var o=p.cloneNode(!0),c=o.querySelector(".card__image"),a=o.querySelector(".card__title"),u=o.querySelector(".card__like-button"),l=o.querySelector(".card__remove-button"),s=o.querySelector(".card__likes-count");return c.src=e.link,c.alt=e.name,a.textContent=e.name,s.textContent=e.likes.length,c.addEventListener("click",(function(){return function(e){_.src=e.link,_.alt=e.name,h.textContent=e.name,d(v)}(e)})),u.addEventListener("click",(function(){!function(e,t,n){e.classList.contains("card__like-button_active")?function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{headers:r.headers,method:"DELETE",body:JSON.stringify({_id:e})}).then(i)}(t).then((function(t){y(t.likes.length,n),e.classList.remove("card__like-button_active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{headers:r.headers,method:"PUT",body:JSON.stringify({_id:e})}).then(i)}(t).then((function(t){y(t.likes.length,n),e.classList.add("card__like-button_active")})).catch((function(e){console.log(e)}))}(u,e._id,s)})),e.likes.forEach((function(e){e._id!==t||u.classList.add("card__like-button_active")})),e.owner._id===t&&(l.classList.add("card__remove-button_active"),l.addEventListener("click",(function(){n(e._id,(function(){o.remove()}))}))),o},S={formSelector:".form",inputSelector:".form__input",inputInvalidSelector:".form__input_invalid",submitButtonSelector:".form__submit-button"},E=document.querySelector(".cards__list"),k=document.querySelector(".profile__add-button"),L=document.querySelector(".popup_type_add-card"),q=document.forms["place-form"],g=q.elements["place-title"],C=q.elements["place-link"],w=document.querySelector(".popup_type_confirm-deletion"),x=document.forms["confirm-deletion-form"],O=w.querySelector(".popup__close-icon"),U=document.querySelector(".profile"),P=U.querySelector(".profile__name"),A=U.querySelector(".profile__about"),N=U.querySelector(".profile__avatar"),T=U.querySelector(".profile__edit-button"),D=document.querySelector(".popup_type_profile"),J=document.forms["profile-form"],j=J.elements["profile-name"],I=J.elements["profile-about"],B=U.querySelector(".profile__avatar-edit-button"),H=document.querySelector(".popup_type_edit-avatar"),z=document.forms["avatar-form"],M=z.elements["avatar-link"],V=function(e){P.textContent=e.name,A.textContent=e.about,N.src=e.avatar,m=e._id};fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(i).then(V).then((function(){fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(i).then((function(e){e.forEach((function(e){var t=K(e);E.append(t)}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}));var X=function(e){e.submitter.textContent="Сохранение..."},F=function(e,t){e.submitter.textContent=t};T.addEventListener("click",(function(){J.reset(),j.value=P.textContent,I.value=A.textContent,d(D)})),J.addEventListener("submit",(function(e){e.preventDefault();var t={name:j.value,about:I.value},n=e.submitter.textContent;X(e),function(e){return fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers,method:"PATCH",body:JSON.stringify({name:e.name,about:e.about})}).then(i)}(t).then(V).catch((function(e){console.log(e)})).finally((function(){l(D),F(e,n)}))})),z.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.submitter.textContent;X(e),(t=M.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{headers:r.headers,method:"PATCH",body:JSON.stringify({avatar:t})}).then(i)).then((function(e){N.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){l(H),F(e,n)}))})),B.addEventListener("click",(function(){z.reset(),d(H)}));var G=function(e,t){d(w);var n=function n(o){var c;("click"===o.type||"keydown"===o.type&&"Escape"===o.key||"mousedown"===o.type&&o.target.classList.contains("popup"))&&(c=!1),"submit"===o.type&&(o.preventDefault(),c=!0),void 0!==c&&function(e,t){return new Promise((function(n,o){e?n(function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{headers:r.headers,method:"DELETE",body:JSON.stringify({_id:e})}).then(i)}(t)):o("Удаление отменено")}))}(c,e).then((function(){t(),l(w)})).catch((function(e){console.log(e)})).finally((function(){document.removeEventListener("keydown",n),w.removeEventListener("mousedown",n),O.removeEventListener("click",n),x.removeEventListener("submit",n)}))};document.addEventListener("keydown",n),w.addEventListener("mousedown",n),O.addEventListener("click",n),x.addEventListener("submit",n)},K=function(e){return b(e,m,G)};k.addEventListener("click",(function(){q.reset(),d(L)})),q.addEventListener("submit",(function(e){e.preventDefault();var t={name:g.value,link:C.value},n=e.submitter.textContent;X(e),function(e){return fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers,method:"POST",body:JSON.stringify({name:e.name,link:e.link})}).then(i)}(t).then((function(e){var t=K(e);E.prepend(t)})).catch((function(e){console.log(e)})).finally((function(){q.reset(),F(e,n),l(L)}))})),function(e){document.querySelectorAll(e.formSelector).forEach((function(r){!function(e,r){var i=e.querySelectorAll(r.inputSelector),a=e.querySelector(r.submitButtonSelector);c(e,a),e.addEventListener("reset",(function(){n(a),i.forEach((function(e){t(e)}))})),i.forEach((function(t){t.addEventListener("input",(function(){o(t),c(e,a)}))}))}(r,e)}))}(S)})();